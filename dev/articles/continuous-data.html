<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Applicability domain methods for continuous data • applicable</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Applicability domain methods for continuous data">
<meta name="robots" content="noindex">
<script defer data-domain="applicable.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">applicable</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/binary-data.html">Applicability domain methods for binary data</a></li>
    <li><a class="dropdown-item" href="../articles/continuous-data.html">Applicability domain methods for continuous data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/applicable/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Applicability domain methods for continuous data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/applicable/blob/main/vignettes/continuous-data.Rmd" class="external-link"><code>vignettes/continuous-data.Rmd</code></a></small>
      <div class="d-none name"><code>continuous-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/applicable" class="external-link">applicable</a></span><span class="op">)</span></span></code></pre></div>
<p><code>applicable</code> provides the following methods to analyze the
applicability domain of your model:</p>
<ul>
<li>Principal component analysis</li>
<li>Hat values statistics</li>
</ul>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We will use the Ames IA housing data for our example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span></code></pre></div>
<p>There are 2,930 properties in the data.</p>
<p>The Sale Price was recorded along with 74 predictors, including:</p>
<ul>
<li>Location (e.g. neighborhood) and lot information.</li>
<li>House components (garage, fireplace, pool, porch, etc.).</li>
<li>General assessments such as overall quality and condition.</li>
<li>Number of bedrooms, baths, and so on.</li>
</ul>
<p>More details can be found in <a href="http://jse.amstat.org/v19n3/decock.pdf" class="external-link">De Cock (2011, Journal of
Statistics Education)</a>.</p>
<p>The raw data are at <a href="http://jse.amstat.org/v19n3/decock/AmesHousing.txt" class="external-link"><code>http://jse.amstat.org/v19n3/decock/AmesHousing.txt</code></a>
but we will use a processed version found in the <a href="https://github.com/topepo/AmesHousing" class="external-link"><code>AmesHousing</code></a>
package. <code>applicable</code> also contains an update for these data
for three new properties (although fewer fields were collected on
these).</p>
<p>To pre-process the training set, we will use the <em>recipes</em>
package. We first tell the recipes that there is an additional value for
the neighborhood in these data, then direct it to create dummy variables
for all categorical predictors. In cases where there are no levels
observed for a factor, we eliminate predictors with a single unique
value, then estimate a transformation that will make the predictor
distributions more symmetric. After these, the data are centered and
scaled. These same transformations will be applied to the new data
points using the statistics estimated from the training set.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ames_new</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">training_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># For consistency, only analyze the data on new properties</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html" class="external-link">one_of</a></span><span class="op">(</span><span class="va">ames_cols</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># There is a new neighborhood in ames_new</span></span>
<span>    Neighborhood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Neighborhood</span><span class="op">)</span>,</span>
<span>    Neighborhood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Neighborhood</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">ames_new</span><span class="op">$</span><span class="va">Neighborhood</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">training_recipe</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">training_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Remove variables that have the same value for every data point.</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html" class="external-link">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Transform variables to be distributed as Gaussian-like as possible.</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_YeoJohnson.html" class="external-link">step_YeoJohnson</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Normalize numeric data to have a mean of zero and</span></span>
<span>  <span class="co"># standard deviation of one.</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="principal-component-analysis">Principal Component Analysis<a class="anchor" aria-label="anchor" href="#principal-component-analysis"></a>
</h3>
<p>The following functions in <code>applicable</code> are used for
principal component analysis:</p>
<ul>
<li>
<code>apd_pca</code>: computes the principal components that account
for up to either 95% or the provided <code>threshold</code> of
variability. It also computes the percentiles of the principal
components and the mean of each principal component.</li>
<li>
<code>autoplot</code>: plots the distribution function for pcas. You
can also provide an optional set of <code>dplyr</code> selectors, such
as <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">dplyr::matches()</a></code> or <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">dplyr::starts_with()</a></code>,
for selecting which variables should be shown in the plot.</li>
<li>
<code>score</code>: calculates the principal components of the new
data and their percentiles as compared to the training data. The number
of principal components computed depends on the <code>threshold</code>
given at fit time. It also computes the multivariate distance between
each principal component and its mean.</li>
</ul>
<p>Let us apply <code>apd_pca</code> modeling function to our data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apd_pca.html">apd_pca</a></span><span class="op">(</span><span class="va">training_recipe</span>, <span class="va">training_data</span><span class="op">)</span></span>
<span><span class="va">ames_pca</span></span>
<span><span class="co">#&gt; # Predictors:</span></span>
<span><span class="co">#&gt;    64</span></span>
<span><span class="co">#&gt; # Principal Components:</span></span>
<span><span class="co">#&gt;    151 components were needed</span></span>
<span><span class="co">#&gt;    to capture at least 95% of the</span></span>
<span><span class="co">#&gt;    total variation in the predictors.</span></span></code></pre></div>
<p>Since no <code>threshold</code> was provided, the function computed
the number of principal components that accounted for at most 95% of the
total variance.</p>
<p>For illustration, setting <code>threshold = 0.25</code> or 25%, we
now need only 10 principal components:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apd_pca.html">apd_pca</a></span><span class="op">(</span><span class="va">training_recipe</span>, <span class="va">training_data</span>, threshold <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">ames_pca</span></span>
<span><span class="co">#&gt; # Predictors:</span></span>
<span><span class="co">#&gt;    64</span></span>
<span><span class="co">#&gt; # Principal Components:</span></span>
<span><span class="co">#&gt;    12 components were needed</span></span>
<span><span class="co">#&gt;    to capture at least 25% of the</span></span>
<span><span class="co">#&gt;    total variation in the predictors.</span></span></code></pre></div>
<p>Plotting the distribution function for the PCA scores is also
helpful:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ames_pca</span><span class="op">)</span></span></code></pre></div>
<p><img src="continuous-data_files/figure-html/autoplot-1.png" class="r-plt" alt="Faceted line chart. abs(value) along the x-axis, percentile along the y-axis. The facets are distance, followed by PC 1 through 12. All lines go up fairly fast." width="768"></p>
<p>You can use regular expressions to plot a smaller subset of the pca
statistics:</p>
<p><img src="continuous-data_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="768"><img src="continuous-data_files/figure-html/unnamed-chunk-5-2.png" class="r-plt" alt="" width="768"></p>
<p>The <code>score</code> function compares the training data to new
samples. Let’s go back to the case where we capture 95% of the variation
in the predictors and score the new samples. Since we used the recipe
interface, we can give the score function the original data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ames_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apd_pca.html">apd_pca</a></span><span class="op">(</span><span class="va">training_recipe</span>, <span class="va">training_data</span><span class="op">)</span></span>
<span><span class="va">pca_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.html">score</a></span><span class="op">(</span><span class="va">ames_pca</span>, <span class="va">ames_new</span><span class="op">)</span></span>
<span><span class="va">pca_score</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"PC00[1-3]"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"distance"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">#&gt;   PC001 PC002 PC003 PC001_pctl PC002_pctl PC003_pctl distance distance_pctl</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  2.47  2.22  8.79       43.4       53.2       97.9     55.9          99.4</span></span></code></pre></div>
<p>Notice how the samples, displayed in red, are fairly dissimilar to
the training set in the first component:</p>
<pre><code><span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_vline()`).</span></span></code></pre>
<p><img src="continuous-data_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="Histogram chart. PC001 along the x-axis, count along the y-axis. A vertical red line is placed inside the distribution." width="768"></p>
<p>What is driving the first component? We can look at which predictors
have the largest values in the rotation matrix (i.e. the values that
define the linear combinations in the PC scores). The top five are:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `ames_pca$pcs` is the output of `prcomp()`</span></span>
<span><span class="va">comp_one</span> <span class="op">&lt;-</span> <span class="va">ames_pca</span><span class="op">$</span><span class="va">pcs</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">comp_one</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">comp_one</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Year_Built      Garage_Cars      Garage_Area   Year_Remod_Add Foundation_PConc </span></span>
<span><span class="co">#&gt;        0.2302333        0.2004821        0.1904687        0.1807016        0.1803793</span></span></code></pre></div>
<p>These three houses are extreme in the most influential variable (year
built) since they were new homes. The also tend to have fairly large
garages:</p>
<p><img src="continuous-data_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="Histogram chart. Garage_Area along the x-axis, count along the y-axis. Two red vertical lines are places. One on the edge of the distribution, another outside the distribution." width="768"></p>
<p>This may be what is driving the first component.</p>
<p>However, the overall distance values are relatively small, which
indicates that, overall, these new houses are not outside the mainstream
of the data.</p>
</div>
<div class="section level3">
<h3 id="hat-values">Hat Values<a class="anchor" aria-label="anchor" href="#hat-values"></a>
</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Leverage_(statistics)" class="external-link">Hat
or leverage values</a> are based on the numerics of linear regression.
The measure the distance of a data point to the center of the training
set distribution. For example, if the numeric training set matrix was
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mi>n</mi><mo>×</mo><mi>p</mi></mrow></msub><annotation encoding="application/x-tex">X_{n \times p}</annotation></semantics></math>,
the <em>hat matrix</em> for the training set would be computed using</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>X</mi><mi>′</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>′</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">H = X'(X'X)^{-1}X</annotation></semantics></math></p>
<p>The corresponding hat values for the training would be the diagonals
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>.
These values can be computed using
<code>stats::hatvalues(lm_model)</code> but only for an <code>lm</code>
model object. Also, it cannot compute the values for new samples.</p>
<p>Suppose that we had a new, unknown sample (as a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p \times 1</annotation></semantics></math>
data vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>).
The hat value for this sample would be</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><msup><mi>u</mi><mo>⊺</mo></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mo>⊺</mo></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>u</mi></mrow><annotation encoding="application/x-tex">h = u^\intercal(X^\intercal X)^{-1}u</annotation></semantics></math>.</p>
<p>The following functions in <code>applicable</code> are used to
compute the hat values of your model:</p>
<ul>
<li>
<code>apd_hat_values</code>: computes the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mo>⊺</mo></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">(X^\intercal X)^{-1}</annotation></semantics></math>.</li>
<li>
<code>score</code>: calculates the hat values of new samples and
their percentiles.</li>
</ul>
<p>Two caveats for using the hat values:</p>
<ol style="list-style-type: decimal">
<li><p>The numerical methods are less tolerant than PCA. For example,
extremely correlated predictors will degrade the ability of the hat
values to be effectively used. Also, since an inverse is used, there
cannot be an linear dependencies within
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.
To resolve this the former example, the recipe step
<code><a href="https://recipes.tidymodels.org/reference/step_corr.html" class="external-link">recipes::step_corr()</a></code> can be used to reduce correlation. For
the latter issue, <code>recipes::step_lincomp()</code> will identify and
remove linear dependencies in the data (as shown below).</p></li>
<li><p>When using a linear or logistic model, the model adds an
intercept columns of ones to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.
For equivalent computations, you should add a vector or ones to the data
or use <code><a href="https://recipes.tidymodels.org/reference/step_intercept.html" class="external-link">recipes::step_intercept()</a></code>.</p></li>
</ol>
<p>Let us apply <code>apd_hat_values</code> modeling function to our
data (while ensuring that there are no linear dependencies):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">non_singular_recipe</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">training_recipe</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_lincomb.html" class="external-link">step_lincomb</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Recipe interface</span></span>
<span><span class="va">ames_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apd_hat_values.html">apd_hat_values</a></span><span class="op">(</span><span class="va">non_singular_recipe</span>, <span class="va">training_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">prev_options</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Marly Gotti, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
